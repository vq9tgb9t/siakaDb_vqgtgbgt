<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Manajemen Kegiatan Harian</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap 5 CSS (CDN) -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <style>
    body {
      background-color: #f5f5f5;
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .app-title {
      font-weight: 700;
    }

    .form-card {
      border-radius: 1rem;
    }

    .kegiatan-item {
      border-left: 4px solid #0d6efd;
      border-radius: 0.75rem;
    }

    .kegiatan-selesai {
      opacity: 0.6;
      text-decoration: line-through;
      border-left-color: #198754;
    }

    @media (max-width: 576px) {
      .app-header {
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="container py-4">
    <!-- Header -->
    <div class="app-header mb-4">
      <div>
        <h1 class="app-title h3 mb-1">Manajemen Kegiatan Harian</h1>
        <p class="text-muted mb-0">
          Catat dan kelola kegiatanmu per hari dengan simpel âœ¨
        </p>
      </div>
      <div class="d-flex flex-column align-items-end">
        <label for="tanggal" class="form-label small mb-1">Tanggal</label>
        <input type="date" id="tanggal" class="form-control form-control-sm">
      </div>
    </div>

    <!-- Form Tambah Kegiatan -->
    <div class="card shadow-sm form-card mb-4">
      <div class="card-body">
        <h2 class="h5 mb-3">Tambah Kegiatan</h2>

        <form id="form-kegiatan" class="row g-3">
          <!-- Nama kegiatan -->
          <div class="col-md-6">
            <label for="namaKegiatan" class="form-label">Nama kegiatan</label>
            <input
              type="text"
              id="namaKegiatan"
              class="form-control"
              placeholder="Contoh: Belajar Struktur Data"
              required
            >
          </div>

          <!-- Jam -->
          <div class="col-md-3">
            <label for="jamKegiatan" class="form-label">Jam (opsional)</label>
            <input
              type="time"
              id="jamKegiatan"
              class="form-control"
            >
          </div>

          <!-- Kategori -->
          <div class="col-md-3">
            <label for="kategoriKegiatan" class="form-label">Kategori</label>
            <select id="kategoriKegiatan" class="form-select">
              <option value="Belajar">Belajar</option>
              <option value="Olahraga">Olahraga</option>
              <option value="Ibadah">Ibadah</option>
              <option value="Istirahat">Istirahat</option>
              <option value="Lainnya" selected>Lainnya</option>
            </select>
          </div>

          <!-- Catatan -->
          <div class="col-12">
            <label for="catatanKegiatan" class="form-label">
              Catatan (opsional)
            </label>
            <textarea
              id="catatanKegiatan"
              class="form-control"
              rows="2"
              placeholder="Contoh: Fokus materi bab 3, jangan sambil buka sosmed ðŸ˜†"
            ></textarea>
          </div>

          <div class="col-12 d-flex justify-content-end">
            <button type="submit" class="btn btn-primary">
              + Tambah Kegiatan
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Daftar Kegiatan -->
    <div>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 class="h5 mb-0">Daftar Kegiatan</h2>
        <small class="text-muted" id="info-tanggal-aktif"></small>
      </div>

      <div id="empty-state" class="text-center text-muted mt-4">
        <p class="mb-0">
          Belum ada kegiatan di tanggal ini. Tambah dulu di form di atas ðŸ‘†
        </p>
      </div>

      <div id="daftar-kegiatan" class="mt-3"></div>
    </div>
  </div>

  <!-- Bootstrap JS (opsional untuk komponen tertentu) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Script Aplikasi -->
  <script>
    const STORAGE_KEY = 'kegiatanHarianV1';

    // Ambil data dari localStorage
    function loadData() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return {};
      try {
        return JSON.parse(raw);
      } catch (e) {
        console.error('Gagal parse data dari localStorage:', e);
        return {};
      }
    }

    // Simpan data ke localStorage
    function saveData(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // Ambil tanggal aktif dari input
    function getCurrentDate() {
      const input = document.getElementById('tanggal');
      return input.value;
    }

    // Warna badge berdasarkan kategori
    function badgeColorForCategory(kat) {
      switch (kat) {
        case 'Belajar':
          return 'primary';
        case 'Olahraga':
          return 'success';
        case 'Ibadah':
          return 'warning';
        case 'Istirahat':
          return 'info';
        default:
          return 'secondary';
      }
    }

    // Render daftar kegiatan
    function renderList() {
      const tanggal = getCurrentDate();
      const data = loadData();
      const list = data[tanggal] || [];

      const container = document.getElementById('daftar-kegiatan');
      const emptyState = document.getElementById('empty-state');
      const infoTanggal = document.getElementById('info-tanggal-aktif');

      infoTanggal.textContent = tanggal ? `Tanggal: ${tanggal}` : '';

      if (!list.length) {
        container.innerHTML = '';
        emptyState.classList.remove('d-none');
        return;
      }

      emptyState.classList.add('d-none');

      // Urutkan berdasarkan jam
      list.sort((a, b) => {
        const ja = a.jam || '';
        const jb = b.jam || '';
        return ja.localeCompare(jb);
      });

      let html = '';
      list.forEach((k) => {
        const badgeColor = badgeColorForCategory(k.kategori);
        const selesaiClass = k.selesai ? 'kegiatan-selesai' : '';

        html += `
          <div class="card mb-2 kegiatan-item ${selesaiClass}">
            <div class="card-body d-flex justify-content-between align-items-start">
              <div>
                <div class="d-flex align-items-center gap-2">
                  <h5 class="card-title mb-0">${k.nama}</h5>
                  <span class="badge text-bg-${badgeColor}">
                    ${k.kategori}
                  </span>
                  ${k.jam
                    ? `<span class="badge text-bg-secondary">${k.jam}</span>`
                    : ''}
                </div>
                ${
                  k.catatan
                    ? `<p class="card-text mt-2 mb-0 small">${k.catatan}</p>`
                    : ''
                }
              </div>
              <div class="btn-group btn-group-sm ms-2">
                <button
                  class="btn btn-outline-success"
                  onclick="toggleSelesai('${tanggal}', ${k.id})"
                >
                  ${k.selesai ? 'Belum' : 'Selesai'}
                </button>
                <button
                  class="btn btn-outline-danger"
                  onclick="hapusKegiatan('${tanggal}', ${k.id})"
                >
                  Hapus
                </button>
              </div>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    // Toggle status selesai
    function toggleSelesai(tanggal, id) {
      const data = loadData();
      const list = data[tanggal] || [];
      const idx = list.findIndex((k) => k.id === id);
      if (idx === -1) return;

      list[idx].selesai = !list[idx].selesai;
      data[tanggal] = list;
      saveData(data);
      renderList();
    }

    // Hapus kegiatan
    function hapusKegiatan(tanggal, id) {
      const yakin = confirm('Yakin mau hapus kegiatan ini?');
      if (!yakin) return;

      const data = loadData();
      const list = data[tanggal] || [];
      data[tanggal] = list.filter((k) => k.id !== id);
      saveData(data);
      renderList();
    }

    // Inisialisasi saat halaman siap
    document.addEventListener('DOMContentLoaded', () => {
      const tanggalInput = document.getElementById('tanggal');
      const today = new Date().toISOString().slice(0, 10);
      tanggalInput.value = today;

      // Render pertama kali
      renderList();

      // Ganti tanggal -> render ulang
      tanggalInput.addEventListener('change', () => {
        renderList();
      });

      // Handle submit form
      const form = document.getElementById('form-kegiatan');
      form.addEventListener('submit', (e) => {
        e.preventDefault();

        const nama = document.getElementById('namaKegiatan').value.trim();
        const jam = document.getElementById('jamKegiatan').value;
        const kategori = document.getElementById('kategoriKegiatan').value;
        const catatan = document.getElementById('catatanKegiatan').value.trim();
        const tanggal = getCurrentDate();

        if (!tanggal) {
          alert('Tanggal belum dipilih.');
          return;
        }

        if (!nama) {
          alert('Nama kegiatan tidak boleh kosong.');
          return;
        }

        const data = loadData();
        if (!data[tanggal]) {
          data[tanggal] = [];
        }

        const kegiatanBaru = {
          id: Date.now(), // id unik sederhana
          nama: nama,
          jam: jam,
          kategori: kategori,
          catatan: catatan,
          selesai: false,
        };

        data[tanggal].push(kegiatanBaru);
        saveData(data);

        form.reset();
        renderList();
      });
    });
  </script>
</body>
</html>
